<!DOCTYPE html>
<html>
   <head>
	<meta name="generator" content="Hugo 0.16" />
        <title>Luoxinjie's Blog</title> 		 
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
		
        <link rel="stylesheet" type="text/css" href="/static/css/style.css" />  
        <link href='http://fonts.useso.com/css?family=PT+Sans+Narrow' rel='stylesheet' type='text/css' />
		<link href='http://fonts.useso.com/css?family=Wire+One' rel='stylesheet' type='text/css' />	
		
		<script type='text/javascript' src='/static/js/jQuery_Migrate_v1.4.1.js'></script>
		<script>jQueryWP = jQuery;</script>
        <script type='text/javascript' src='/static/js/jQuery_v1.12.4.js'></script>
		<script type='text/javascript' src='/static/js/main.js'></script>
		<script type='text/javascript' src='/static/js/wp_embed_min.js'></script>
		
         
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/wiresareobsolete.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5.3"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
			img.wp-smiley,
			img.emoji {
				display: inline !important;
				border: none !important;
				box-shadow: none !important;
				height: 1em !important;
				width: 1em !important;
				margin: 0 .07em !important;
				vertical-align: -0.1em !important;
				background: none !important;
				padding: 0 !important;
			}
		</style>
		 
		
		<style type="text/css">
		     ul li{list-style: none;float:left;}
			.blog-title a, .blog-description, .social-icons a { color: #ffffff; }
		
			.site-head { background-color: #303538; }
		                
			section a { color: #4a4a4a; }
		
			a:hover, body .blog-title a:hover, body .social-icons a:hover { color: #57A3E8; }
			.main-navigation a { color: #ffffff; }
		    .main-navigation a { color: #50585D; }
            .home .main-navigation a { color: #ffffff; }
        </style>

    </head>

    <body class="home blog paged paged-2"> 
           <header id="masthead" role="banner" class="site-head site-header">
                <nav id="site-navigation" class="main-navigation" role="navigation">
                     <div>
                            <h1 class="menu-toggle">
                                <a class="icon-bars" href="#">
                                 <span class="hidden">Menu</span>
                                 </a>
                            </h1>
                           <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
                          <div class="menu-main-menu-container">
						   <ul id="menu-main-menu" class="menu">
								<li id="menu-item-878" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-878">
						           <a href="https://github.com/RogerGold" target="_blank"><img height="28" width="28" src="/media/github.png"  alt="github"/>
								   </a>
								</li>
								<li id="menu-item-878" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-878">
						           <a href="http://blog.csdn.net/luoxinjie" target="_blank"><img height="28" width="28" src="/media/scdn.png"  alt="csdn"/>
								   </a>								 
								</li>
                            </ul>
							</div>        
						</div>
				</nav>

				<div class="vertical-row">
					<div class="vertical">
					<div class="site-head-content inner">
                         <div>	
                             <img  src="/media/luoxinjie.png"  alt="photo"/>							 
					     </div>
					 <h1 class="blog-title"><a class="blog-logo" href='https://luoxinjie.github.io/' rel='home'>Luoxinjie</a></h1>
					 <h2 class="blog-description">A young people who like Android and Design.</h2>
					</div>
					</div>
				</div>
		   </header>
		   
	       <main id="content" class="content" role="main">
		   
		   
		   <article id="post-771" class="post-771 post type-post status-publish format-standard hentry category-android wpautop">
				<header class="post-header">
					<span class="post-meta">
						<span class="posted-on">
						
								<time class="entry-date published" datetime="2016-07-27T12:32:03+00:00">July 27, 2016
								</time>
							
						</span>
						<span class="byline"> by 
							<span class="author vcard">
								<a class="url fn n" href="https://github.com/RogerGold">
									Luoxinjie
								</a>
							</span>
						</span> 
						on 
						<a href="/android/" rel="category tag" target="_blank">
						Android
						</a>			
					</span>
							
						<h1 class="post-title">
							   
							   Android应用架构演变
						</h1>
         
				</header>
				<section class="post-content">
				    <p>
					    <img src="/media/androidArchitecture.jpeg"  alt="androidArchitecture"/>
					</p>
					<p>
					   Android的开发生态系统变化迅速，每周都有新的工具，新的库更新。我们用于构建Android应用程序的体系结构和技术也不断发展。
					</p>
					<p>
					<h4>Initial Architecture</h4>
					   开始，使用简单粗暴的架构，代码是两层结构：数据层负责从REST APIs检索/保存数据和存储持久性数据。视图层，负责处理和显示UI上的数据.<br/>
					   APIProvider则提供了一些方法让Activities和Fragments更容易的和REST API交互。
					   类似的，CacheProvider 包含一些检索和存储 SharedPreferences 或者 SQLite 数据的方法，使用回调把结果返回给Acticities。<br/>
					   <img src="/media/initialArchitecture.png"  alt="androidArchitecture"/>
					   <br/>
					    这种结构的主要问题在于视图层负责太多了，想象一下，应用加载一个博客文章列表，先把这些文章存到SQLite数据库然后在把这些文章在ListView里显示出来，
						那么Activity就需要做下面的事情：<br/>
				        调用 APIProvider 里的回调方法loadPosts，等待这个回调成功，然后调用CacheProvider里的回调方法savePosts，又等待这个回调成功，
						最后在ListView显示。<br/>
						这是一个简单的例子， 实际开发中会更复杂，这样会使得Activities和Fragments变得非常的臃肿和难以维护，
						大量的嵌套回调也意味着代码的难以理解，这时要对代码做一些改变或者添加新的功能是非常痛苦的事情。
						而且大量的逻辑都在其中,单元测试也变得困难。
					</p>
					<p>
					<h4>RxJava Driven Architecture</h4>
					    <a href="http://reactivex.io/" target="_blank">RxJava</a>的出现终于可以解决嵌套回调的问题，RxJave可以通过异步流管理数据。类似上一种架构，这个架构也分为数据层和视图层，
						数据层包含DataManager 和一系列的 helpers。视图层由Android框架控件组成。<br/>
						Helper类即辅助类，有非常具体的责任，并以简明的方式实现它们。例如，大多数项目都有一些helper类来访问REST API，读取数据或与
						第三方的SDK进行交互。不同的应用将具有不同数量的helper类，但最常见的是：<br/>
						PreferencesHelper ：读取和保存SharedPreferences数据。<br/>
						DatabaseHelper ：处理访问SQLite数据库。<br/>
                        Retrofit services：执行REST APIs回调方法。<br/>
						DataManager是体系结构的大脑，它广泛使用RxJava来对从辅助类检索的数据进行合并，过滤等操作。
						DataManager的目的是减少Activities和Fragments的工作量。						
					</p>
					 <img src="/media/RxJava_driven_architecture.png"  alt="androidArchitecture"/>
					<p>
					   为什么这个架构更好？<br/>
					   1. 不需要嵌套回调。<br/>
					   2. DataManager接管了以前视图层的一部分责任。因此，它使Activities和Fragments更轻巧。<br/>
					   3. 单元测试更加容易。<br/>
					   4. 清晰的责任分离，只有DataManager作为唯一与数据层交互的点。 
					</p>
					<p>
					    这个架构的问题？<br/>
						1. 对于大型和非常复杂的项目,DataManager会变得过于臃肿，难以维护。<br/>
						2. 虽然视图层组件，如活动和片段变得更加轻巧，他们仍然必须处理管理RxJava订阅，分析错误等相当数量的逻辑。
					</p>
					<p>
					   <h4>MVP Based Architecture</h4>
					     数据层保持不变，只是叫Pattern更合适。<br/>
						 Presenters负责从数据层加载数据和当结果处理好后调用视图层里正确的方法。
						 他订阅DataManager返回的被观察者，因此他会处理调度和订阅的事情，此外，他还可以分析错误代码，如果需要还可以
						 对数据进行额外的操作。
						 例如，我们需要过滤一些数据，而这些过滤不会在其他地方被复用，那就可以在Presenters层实现而不是在DataManager。
						 <br/>
						 视图层由Presenters协助，所以不直接订阅被观察者，主要是实现一些接口，如showError()或showProgressIndicator()。
						 也负责处理用户交互，例如点击事件，视图层调用Presenters里的正确方法来做相应处理。
						 例如，我们通过点击一个按钮加载一系列文章，我们的Activity在onClick listener里将调用presenter.loadTodayPosts()方法。
					</p>
					<img src="/media/MVP_based_architecture.png"  alt="androidArchitecture"/>
					<p>
					  为什么这种架构更好？<br/>
					  1. 活动和片段变得非常轻巧。他们唯一的责任是建立/更新用户界面和处理用户事件。因此，它们变得更易于维护。<br/>
					  2. 很容易进行单元测试。<br/>
					  3. 整个架构变得非常友好。如果DataManager变得臃肿，我们可以通过移动一些代码到Presenters缓解这一问题。<br/>
					</p>
					<p>
					   还有什么问题？<br/>
					   当代码库变得非常庞大和复杂，只有一个数据管理器（DataManager）仍然是一个问题。
					 
					</p>
					<p>
					  需要强调的是这也不是完美的架构，相信有一种架构能完美的解决所有问题是很图样图森的，Android生态系统将继续以快速的步伐不断发展，
					  我们必须通过探索，阅读和实验，使我们可以找到更好的方法来继续建设优秀的Android应用程序。
					</p>
					<div class="clear">&nbsp;</div>
				</section>
		</article>
		  
		   
		   
		
		
	    <div id="secondary" class="widget-area" role="complementary">
				<div class="clear">&nbsp;</div>
	    </div>  
		
		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info inner">
				<section class="copyright">
					  <a href="https://github.com/RogerGold" target="_blank"><img height="28" width="28" src="/media/github.png"  alt="github"/>Contact Me</a>					
				</section>
			</div>
		</footer>
		
		</main>
		 <script type="text/javascript">
        
        var disqus_shortname = 'wiresareobsolete';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        
        </script>
	</body>
</html>
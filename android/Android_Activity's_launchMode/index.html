<!DOCTYPE html>
<html>
   <head>
	<meta name="generator" content="Hugo 0.16" />
        <title>Luoxinjie's Blog</title> 		 
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
		
        <link rel="stylesheet" type="text/css" href="/static/css/style.css" />  
        <link href='http://fonts.useso.com/css?family=PT+Sans+Narrow' rel='stylesheet' type='text/css' />
		<link href='http://fonts.useso.com/css?family=Wire+One' rel='stylesheet' type='text/css' />	
		
		<script type='text/javascript' src='/static/js/jQuery_Migrate_v1.4.1.js'></script>
		<script>jQueryWP = jQuery;</script>
        <script type='text/javascript' src='/static/js/jQuery_v1.12.4.js'></script>
		<script type='text/javascript' src='/static/js/main.js'></script>
		<script type='text/javascript' src='/static/js/wp_embed_min.js'></script>
		
         
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/wiresareobsolete.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5.3"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
			img.wp-smiley,
			img.emoji {
				display: inline !important;
				border: none !important;
				box-shadow: none !important;
				height: 1em !important;
				width: 1em !important;
				margin: 0 .07em !important;
				vertical-align: -0.1em !important;
				background: none !important;
				padding: 0 !important;
			}
		</style>
		 
		
		<style type="text/css">
		     ul li{list-style: none;float:left;}
			.blog-title a, .blog-description, .social-icons a { color: #ffffff; }
		
			.site-head { background-color: #303538; }
		                
			section a { color: #4a4a4a; }
		
			a:hover, body .blog-title a:hover, body .social-icons a:hover { color: #57A3E8; }
			.main-navigation a { color: #ffffff; }
		    .main-navigation a { color: #50585D; }
            .home .main-navigation a { color: #ffffff; }
        </style>

    </head>

    <body class="home blog paged paged-2"> 
           <header id="masthead" role="banner" class="site-head site-header">
                <nav id="site-navigation" class="main-navigation" role="navigation">
                     <div>
                            <h1 class="menu-toggle">
                                <a class="icon-bars" href="#">
                                 <span class="hidden">Menu</span>
                                 </a>
                            </h1>
                           <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
                          <div class="menu-main-menu-container">
						   <ul id="menu-main-menu" class="menu">
								<li id="menu-item-878" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-878">
						           <a href="https://github.com/RogerGold" target="_blank"><img height="28" width="28" src="/media/github.png"  alt="github"/>
								   </a>
								</li>
								<li id="menu-item-878" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-878">
						           <a href="http://blog.csdn.net/luoxinjie" target="_blank"><img height="28" width="28" src="/media/scdn.png"  alt="csdn"/>
								   </a>								 
								</li>
                            </ul>
							</div>        
						</div>
				</nav>

				<div class="vertical-row">
					<div class="vertical">
					<div class="site-head-content inner">
                         <div>	
                             <img  src="/media/luoxinjie.png"  alt="photo"/>							 
					     </div>
					 <h1 class="blog-title"><a class="blog-logo" href='https://luoxinjie.github.io/' rel='home'>Luoxinjie</a></h1>
					 <h2 class="blog-description">A young people who like Android and Design.</h2>
					</div>
					</div>
				</div>
		   </header>
		   
	       <main id="content" class="content" role="main">
		   
		   
		   <article id="post-771" class="post-771 post type-post status-publish format-standard hentry category-android wpautop">
				<header class="post-header">
					<span class="post-meta">
						<span class="posted-on">
						
								<time class="entry-date published" datetime="2016-08-2T12:32:03+00:00">Aug 2, 2016
								</time>
							
						</span>
						<span class="byline"> by 
							<span class="author vcard">
								<a class="url fn n" href="https://github.com/RogerGold">
									Luoxinjie
								</a>
							</span>
						</span> 
						on 
						<a href="/android/" rel="category tag" target="_blank">
						Android
						</a>			
					</span>
							
						<h1 class="post-title">
							   
							     Android Activity 启动模式
						</h1>
         
				</header>
				<section class="post-content">				
					 <p>
					   每个Activity都有不同的使用目的，比如邮箱客户端，收件箱是展示收件箱，所以这个Activity不建议创建成多个实例。而写邮件的Activity，因为我们可以同时写多封邮件，
					   可以实例化多个此Activity对象。设置是否使用已存在的实例还是多次创建，就需要使用Activity启动模式。
					 </p>
					<p>
					   我们通过在AndroidManifest.xml 文件中的activity标签设置其android:launchMode属性来决定该Activity启动模式或者在用intent启动时Activity设置
					   intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP)相应属性。</br>
					   有四种启动模式：standard, singleTop, singleTask 和 singleInstance。
					</p>
					<p>
					   <h4>重要的概念</h4>
					    任务：任务是指在执行特定作业时与用户交互的一系列 Activity。 这些 Activity 按照各自的打开顺序排列在堆栈（即“返回栈”）中。<br/></br>
						返回栈：当前 Activity 启动另一个 Activity 时，该新 Activity 会被推送到堆栈顶部，成为焦点所在。 
						前一个 Activity 仍保留在堆栈中，但是处于停止状态。Activity 停止时，系统会保持其用户界面的当前状态。 
						用户按“返回”按钮时，当前 Activity 会从堆栈顶部弹出（Activity 被销毁），
						而前一个 Activity 恢复执行（恢复其 UI 的前一状态）。 堆栈中的 Activity 永远不会重新排列，仅推入和弹出堆栈：
						由当前 Activity 启动时推入堆栈；用户使用“返回”按钮退出时弹出堆栈。当所有 Activity 均从堆栈中弹出后，任务即不复存在。
						因此，返回栈以“后进先出”对象结构运行。 
						<br/> <img src="/media/diagram_backstack.png"  alt="diagram_backstack.png"/>
					</p>
					<p>
					  <h4>standard</h4>
					   这是默认的启动模式，没有设置或者android:launchMode设置为standard的Activity就会使用这种模式。<br/>
                    设置成这个值后，每当打开Activity一次，就会创建一个新的Activity实例，比如写邮件Activity是这个启动模式，
					如果你打开了10次写邮件，就会有10个Activity实例，注意，也意味着你要退出就要关掉10个Activity。
					<br/><img src="/media/standardtopstandard.jpg"  alt="standardtopstandard.jpg"/>
					</p>
					<p>
					  <h4>singleTop</h4>
					  使用singleTop的Activity,如果该Activity不在返回栈的栈顶，则创建新的实例。如果该Activity已经位于栈顶，
					  则不创建新实例，而是使用当前的这个Activity实例，并调用这个实例的onNewIntent方法。<br/> 
					  所以在singleTop这种模式下，我们需要处理onCreate和onNewIntent这两个方法，确保不同的情况都能正常工作。<br/>
					  singleTop使用例子：假设有一个搜索框，每次搜索查询都会将我们引导至SearchActivity查看结果，为了更好的交互体验，
					  我们在结果页顶部也放置这样的搜索框。假设一下，SearchActivity启动模式为standard，
					  那么每一个搜索都会创建一个新的SearchActivity实例，10次查询就是10个Activity。
					  当我们想要退回到非SearchActivity，我们需要按返回键10次，这会是糟糕的用户体验。
					  <br/><img src="/media/singletop.jpg"  alt="singletop.jpg"/>
					</p>
					<p>
					    <h4>singleTask</h4>
						singleTask启动模式的Activity在系统中只会存在一个实例。</br>						
						如果系统中不存在Activity的实例，那么就需要创建这个Activity的实例，并且将这个实例放入栈顶。
						如果Activity实例已然存在，那么在Activity回退栈中，所有位于该Activity上面的Activity实例都将被销毁掉（销毁过程会调用Activity生命周期回调），这样使得Activity实例位于栈顶。
						与此同时，Intent会通过onNewIntent()传递到这个SingleTask Activity实例。<br/>
						该模式的使用场景多类似于邮件客户端的收件箱页面。收件箱Activity只保持一个实例即可，但是也要谨慎使用这种模式，因为它可以在用户未感知的情况下销毁掉其他Activity。
						  <br/><img src="/media/singleTaskD.jpg"  alt="singleTaskD.jpg"/>
					</p>
					<p>
				        <h4>singleInstance</h4>
						 这个模式和singleTask差不多，因为他们在系统中都只有一份实例。</br>	
						 唯一不同的就是存放singleInstance Activity实例的返回栈只能存放一个该模式的Activity实例。
						 如果从singleInstance Activity实例启动另一个Activity，那么这个Activity实例会放入其他的返回栈中。
						 同理，如果singleInstance Activity被别的Activity启动，它也会放入不同于调用者的返回栈中。<br/>
						 虽然是两个返回栈，但是在系统的任务管理器中，却始终显示一个，即最新打开的返回栈。
						 这样虽然返回栈1还在后台工作但是我们无法访问到他。解决这个问题的方法就是添加taskAffinity=""属性即可。这样在
						 任务管理器中就能看到两个返回栈。<br/>
						 这种模式的使用情况比较罕见，建议谨慎使用。<br/>
						  <img src="/media/singleInstance_new_instance.jpg"  alt="singleInstance_new_instance.jpg"/>
					</p>
					<p>
					   <h4>总结</h4>
					    <img src="/media/launchModel.PNG"  alt="launchModel.PNG"/>
					</p>
					<p>
					<h4>参考资料</h4>
					<a href="https://inthecheesefactory.com/blog/understand-android-activity-launchmode/en" rel="category tag" target="_blank">understand-android-activity-launchmode</a></br>
					<a href="https://developer.android.com/guide/topics/manifest/activity-element.html" rel="category tag" target="_blank">developer.android.com</a>
					</p>
					<div class="clear">&nbsp;</div>
				</section>
		</article>
		  
		   
		   
		
		
	    <div id="secondary" class="widget-area" role="complementary">
				<div class="clear">&nbsp;</div>
	    </div>  
		
		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info inner">
				<section class="copyright">
					  <a href="https://github.com/RogerGold" target="_blank"><img height="28" width="28" src="/media/github.png"  alt="github"/>Contact Me</a>					
				</section>
			</div>
		</footer>
		
		</main>
		 <script type="text/javascript">
        
        var disqus_shortname = 'wiresareobsolete';
        (function () {
            var nodes = document.getElementsByTagName('span');
            for (var i = 0, url; i < nodes.length; i++) {
                if (nodes[i].className.indexOf('dsq-postid') != -1) {
                    nodes[i].parentNode.setAttribute('data-disqus-identifier', nodes[i].getAttribute('data-dsqidentifier'));
                    url = nodes[i].parentNode.href.split('#', 1);
                    if (url.length == 1) { url = url[0]; }
                    else { url = url[1]; }
                    nodes[i].parentNode.href = url + '#disqus_thread';
                }
            }
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
        
        </script>
	</body>
</html>